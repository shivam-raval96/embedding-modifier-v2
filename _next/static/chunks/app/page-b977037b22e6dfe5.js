(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5165:function(e,t,a){Promise.resolve().then(a.bind(a,9589))},9589:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Home}});var s=a(7437),n=a(2265),l=a(1620);function ScatterPlot(e){var t,a;let{data:r,onSelectionChange:i,colorAttribute:o="cluster"}=e,d=(0,n.useRef)(),[c,u]=(0,n.useState)({width:800,height:600}),[m,h]=(0,n.useState)(null),[x,g]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let handleResize=()=>{var e;let t=null===(e=d.current)||void 0===e?void 0:e.parentElement;t&&u({width:t.clientWidth,height:Math.max(600,t.clientHeight)})};return handleResize(),window.addEventListener("resize",handleResize),()=>window.removeEventListener("resize",handleResize)},[]),(0,n.useEffect)(()=>{if(!r||!d.current)return;let e=l.Ys(d.current);e.selectAll("*").remove();let t={top:20,right:20,bottom:40,left:40},a=c.width-t.left-t.right,s=c.height-t.top-t.bottom,n=l.BYU().domain(l.Wem(r,e=>e.x)).range([0,a]).nice(),u=l.BYU().domain(l.Wem(r,e=>e.y)).range([s,0]).nice(),getColorValue=e=>o?e[o]||"unknown":"default",m=l.PKp().domain([...new Set(r.map(getColorValue))]).range(o?l.Cn1:["#64748b"]),g=e.attr("width",c.width).attr("height",c.height).append("g").attr("transform","translate(".concat(t.left,",").concat(t.top,")")),b=l.sPX().scaleExtent([.5,10]).on("zoom",e=>{g.attr("transform","translate(".concat(t.left+e.transform.x,",").concat(t.top+e.transform.y,") scale(").concat(e.transform.k,")"))});e.call(b);let p=g.selectAll(".point").data(r).enter().append("circle").attr("class","point").attr("cx",e=>n(e.x)).attr("cy",e=>u(e.y)).attr("r",4).style("fill",e=>m(getColorValue(e))).style("opacity",.7).style("stroke","#fff").style("stroke-width",.5).style("cursor","pointer");p.on("mouseover",(e,t)=>{let a=d.current.getBoundingClientRect();h({...t,x:e.clientX-a.left,y:e.clientY-a.top}),l.Ys(e.target).transition().duration(200).attr("r",6).style("opacity",1)}).on("mousemove",(e,t)=>{let a=d.current.getBoundingClientRect();h(t=>t?{...t,x:e.clientX-a.left,y:e.clientY-a.top}:null)}).on("mouseout",e=>{h(null),l.Ys(e.target).transition().duration(200).attr("r",4).style("opacity",.7)});let f=[],j=!1,v=e.append("path").attr("class","lasso").style("fill","rgba(59, 130, 246, 0.1)").style("stroke","#3b82f6").style("stroke-width",2).style("stroke-dasharray","5,5").style("opacity",0).style("pointer-events","none"),y=e.append("rect").attr("width",c.width).attr("height",c.height).style("fill","none").style("pointer-events",x?"all":"none").style("cursor",x?"crosshair":"default");y.style("pointer-events",x?"all":"none"),y.on("mousedown",a=>{if(!x)return;a.preventDefault(),a.stopPropagation(),j=!0,f=[];let[s,n]=l.cx$(a,e.node());f.push([s-t.left,n-t.top]),v.style("opacity",1)}),y.on("mousemove",a=>{if(!j||!x)return;a.preventDefault();let[s,n]=l.cx$(a,e.node());if(f.push([s-t.left,n-t.top]),f.length>1){let e="M".concat(f.map(e=>e.join(",")).join("L"),"Z");v.attr("d",e)}}),y.on("mouseup",e=>{if(j&&x){if(e.preventDefault(),j=!1,v.style("opacity",0),f.length>2){let e=r.filter(e=>{let t=[n(e.x),u(e.y)];return isPointInPolygon(t,f)});i(e),p.style("stroke",t=>{let a=e.some(e=>e.id===t.id);return a?"#fbbf24":"#fff"}).style("stroke-width",t=>{let a=e.some(e=>e.id===t.id);return a?3:.5}).style("opacity",t=>{let a=e.some(e=>e.id===t.id);return a?1:.7})}f=[]}}),x?e.on(".zoom",null):e.call(b)},[r,c,x,o]);let isPointInPolygon=(e,t)=>{let[a,s]=e,n=!1;for(let e=0,l=t.length-1;e<t.length;l=e++){let[r,i]=t[e],[o,d]=t[l];i>s!=d>s&&a<(o-r)*(s-i)/(d-i)+r&&(n=!n)}return n};return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"absolute top-4 right-4 z-10 flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>g(!x),className:"px-3 py-1 rounded text-sm font-medium transition-colors ".concat(x?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:x?"Exit Lasso":"Lasso Select"}),i&&(0,s.jsx)("button",{onClick:()=>{i([]),d.current&&l.Ys(d.current).selectAll(".point").style("stroke","#fff").style("stroke-width",.5).style("opacity",.7)},className:"px-3 py-1 rounded text-sm font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 transition-colors",children:"Clear Selection"})]}),(0,s.jsx)("svg",{ref:d,className:"w-full"}),m&&(0,s.jsxs)("div",{className:"absolute pointer-events-none bg-slate-900 text-white p-3 rounded-lg shadow-xl border border-slate-600 max-w-sm z-20",style:{left:Math.min(m.x+15,c.width-300),top:Math.max(m.y-15,10)},children:[(0,s.jsxs)("div",{className:"font-medium text-sm mb-2 leading-tight",children:[null===(t=m.text)||void 0===t?void 0:t.substring(0,150),(null===(a=m.text)||void 0===a?void 0:a.length)>150?"...":""]}),(0,s.jsxs)("div",{className:"text-xs text-slate-400 flex justify-between",children:[(0,s.jsxs)("span",{children:["Cluster: ",m.cluster]}),(0,s.jsxs)("span",{children:["ID: ",m.id]})]}),m.language&&(0,s.jsxs)("div",{className:"text-xs text-blue-400 mt-1",children:["Topic:"," ",m.language+" "+m.sentiment+" "+m.cats]})]})]})}var components_ControlPanel=function(e){let{config:t,onConfigChange:a,isProcessing:n,availableAttributes:l=[],selectedColorAttribute:r=null}=e,handleChange=(e,t)=>{a({[e]:Number(t)})},handleColorAttributeChange=e=>{a({colorAttribute:e})};return(0,s.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700",children:[(0,s.jsx)("h3",{className:"text-white font-semibold mb-4",children:"Parameters"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"border-b border-slate-600 pb-4 mb-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Color by Attribute"}),(0,s.jsxs)("select",{value:r||"",onChange:e=>handleColorAttributeChange(e.target.value||null),disabled:n,className:"w-full p-2 bg-slate-700 border border-slate-600 rounded-md text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,s.jsx)("option",{value:"",children:"Default (no coloring)"}),l.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),r&&(0,s.jsxs)("p",{className:"text-xs text-slate-400 mt-1",children:["Coloring points by: ",r]})]})}),(0,s.jsxs)("div",{className:"border-b border-slate-600 pb-4 mb-4",children:[(0,s.jsx)("h4",{className:"text-slate-200 font-medium mb-3 text-sm",children:"Embedding Adjustments"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Language: ",t.languageAdjustment]}),(0,s.jsx)("input",{type:"range",min:"-1",max:"1",step:"0.1",value:t.languageAdjustment,onChange:e=>handleChange("languageAdjustment",e.target.value),disabled:n,className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider"}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-slate-400 mt-1",children:[(0,s.jsx)("span",{children:"Increase emphasis"}),(0,s.jsx)("span",{children:"Reduce emphasis"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Sentiment: ",t.sentimentAdjustment]}),(0,s.jsx)("input",{type:"range",min:"-2",max:"2",step:"0.1",value:t.sentimentAdjustment,onChange:e=>handleChange("sentimentAdjustment",e.target.value),disabled:n,className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider"}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-slate-400 mt-1",children:[(0,s.jsx)("span",{children:"Negative"}),(0,s.jsx)("span",{children:"Positive"})]})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-slate-200 font-medium mb-3 text-sm",children:"UMAP Parameters"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["UMAP Neighbors: ",t.umapNeighbors]}),(0,s.jsx)("input",{type:"range",min:"5",max:"50",value:t.umapNeighbors,onChange:e=>handleChange("umapNeighbors",e.target.value),disabled:n,className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["UMAP Min Distance: ",t.umapMinDist]}),(0,s.jsx)("input",{type:"range",min:"0.01",max:"1",step:"0.01",value:t.umapMinDist,onChange:e=>handleChange("umapMinDist",e.target.value),disabled:n,className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider"})]})]})]})]})]})};function DatasetSelector(e){var t;let{selectedDataset:a,onDatasetChange:n,isLoading:l}=e,r=[{id:"data1",name:"Eng-Fr texts",description:"Some synthetic data"},{id:"data2",name:"Dummy data",description:"To be updated..."}];return(0,s.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700",children:[(0,s.jsx)("h3",{className:"text-white font-semibold mb-4",children:"Dataset Selection"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Choose Dataset"}),(0,s.jsx)("select",{value:a,onChange:e=>n(e.target.value),disabled:l,className:"w-full bg-slate-700 border border-slate-600 text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50",children:r.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))}),a&&(0,s.jsx)("div",{className:"text-sm text-slate-400 mt-2",children:null===(t=r.find(e=>e.id===a))||void 0===t?void 0:t.description}),l&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-blue-400 mt-2",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-400"}),"Loading dataset..."]})]})]})}var r=a(1921);async function processEmbeddings(e,t){let a=e.map(e=>e.embedding);e.map(e=>e.text);let s=await adjustEmbeddings(a,t),n=await realUMAP(s,t),l=getAvailableAttributes(e);return{processedData:e.map((e,t)=>({...e,x:n[t][0],y:n[t][1],id:t})),availableAttributes:l}}function getAvailableAttributes(e){if(!e||0===e.length)return[];let t=Object.keys(e[0]),a=["embedding","text","id"],s=t.filter(e=>!a.includes(e));return s}async function realUMAP(e,t){let a=new r.u({nNeighbors:t.umapNeighbors,minDist:t.umapMinDist,nComponents:2});return await a.fitAsync(e)}async function adjustEmbeddings(e,t){if(0===t.languageAdjustment&&0===t.sentimentAdjustment)return e;let a=e.map(e=>[...e]);if(0!==t.languageAdjustment){let e=await loadVector("data/language_vector.json");e?a=projectOutDirection(a,e,t.languageAdjustment):console.warn("Language vector not found, skipping language adjustment")}if(0!==t.sentimentAdjustment){let e=await loadVector("data/sentiment_vector.json");e?a=projectOutDirection(a,e,t.sentimentAdjustment):console.warn("Sentiment vector not found, skipping sentiment adjustment")}return a}function projectOutDirection(e,t,a){let s=Math.sqrt(t.reduce((e,t)=>e+t*t,0));if(0===s)return console.warn("Steering vector has zero norm, returning original data"),e;let n=t.map(e=>e/s),l=e.map(e=>e.reduce((e,t,a)=>e+t*n[a],0)),r=e.map((e,t)=>{let s=l[t];return e.map((e,t)=>e-a*s*n[t])});return r}async function loadVector(e){try{let t=await fetch(e);if(!t.ok)throw Error("Failed to load ".concat(e,": ").concat(t.statusText));let a=await t.json();return a}catch(t){return console.error("Error loading vector ".concat(e,":"),t),null}}let i={data1:()=>loadJSONDataset("/data/data1.json"),data2:()=>loadJSONDataset("/data/data2.json")};async function loadDataset(e){if(!i[e])throw Error("Dataset ".concat(e," not found"));try{return await i[e]()}catch(t){return console.warn("Failed to load ".concat(e,", falling back to sample data:"),t),generateSampleData()}}async function loadJSONDataset(e){try{var t,a;let s=await fetch(e);if(!s.ok)throw Error("HTTP error! status: ".concat(s.status));let n=await s.json();if(!Array.isArray(n)||!(null===(t=n[0])||void 0===t?void 0:t.embedding)||!(null===(a=n[0])||void 0===a?void 0:a.text))throw Error("Invalid data format. Expected array with embedding and text fields.");return n}catch(t){throw console.error("Error loading dataset from ".concat(e,":"),t),t}}function EmbeddingVisualizer(){let[e,t]=(0,n.useState)(null),[a,l]=(0,n.useState)(null),[r,i]=(0,n.useState)([]),[o,d]=(0,n.useState)([]),[c,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)("data1"),[x,g]=(0,n.useState)({umapNeighbors:15,umapMinDist:.1,colorAttribute:null,languageAdjustment:0,sentimentAdjustment:0});(0,n.useEffect)(()=>{loadSelectedDataset("data1")},[]),(0,n.useEffect)(()=>{e&&processData()},[e,x.umapNeighbors,x.umapMinDist,x.languageAdjustment,x.sentimentAdjustment]);let processData=async()=>{if(e){u(!0);try{let t=await processEmbeddings(e,x);t.processedData&&t.availableAttributes?(l(t.processedData),i(t.availableAttributes)):(l(t),i([]))}catch(e){console.error("Error processing data:",e)}finally{u(!1)}}},loadSelectedDataset=async e=>{u(!0);try{let a=await loadDataset(e);t(a),d([]),h(e)}catch(e){console.error("Error loading dataset:",e)}finally{u(!1)}};return(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-slate-800 mb-1",children:"Embedding Visual Modifier"}),(0,s.jsx)("p",{className:"text-slate-600 text-sm mb-4",children:"Modify the embeddings based on concepts"})]}),(0,s.jsx)(DatasetSelector,{selectedDataset:m,onDatasetChange:loadSelectedDataset,isLoading:c}),(0,s.jsx)(components_ControlPanel,{config:x,onConfigChange:e=>{g(t=>({...t,...e}))},isProcessing:c,availableAttributes:r,selectedColorAttribute:x.colorAttribute}),o.length>0&&(0,s.jsxs)("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:[(0,s.jsxs)("h3",{className:"text-slate-800 font-semibold mb-3",children:["Selected Points (",o.length,")"]}),(0,s.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:o.map((e,t)=>{var a;return(0,s.jsxs)("div",{className:"text-sm text-slate-700 p-2 bg-white rounded border border-slate-200",children:[(0,s.jsxs)("div",{className:"font-medium",children:[null===(a=e.text)||void 0===a?void 0:a.substring(0,50),"..."]}),(0,s.jsxs)("div",{className:"text-xs text-slate-500",children:[x.colorAttribute&&e[x.colorAttribute]&&(0,s.jsxs)(s.Fragment,{children:[x.colorAttribute,": ",e[x.colorAttribute]," ","|"," "]}),"ID: ",e.id]})]},t)})})]})]}),(0,s.jsx)("div",{className:"lg:col-span-3",children:(0,s.jsx)("div",{className:"bg-white rounded-lg border-2 border-black overflow-hidden",children:c?(0,s.jsx)("div",{className:"h-96 flex items-center justify-center bg-white",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-slate-700",children:"Processing embeddings..."})]})}):a?(0,s.jsx)(ScatterPlot,{data:a,colorAttribute:x.colorAttribute,onSelectionChange:d}):(0,s.jsx)("div",{className:"h-96 flex items-center justify-center text-slate-500 bg-white",children:"Select a dataset to begin visualization"})})})]})}function Home(){return(0,s.jsxs)("main",{className:"min-h-screen bg-white",children:[(0,s.jsx)("head",{children:(0,s.jsx)("script",{src:"https://cdn.tailwindcss.com"})}),(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsx)(EmbeddingVisualizer,{})})]})}}},function(e){e.O(0,[832,971,472,744],function(){return e(e.s=5165)}),_N_E=e.O()}]);
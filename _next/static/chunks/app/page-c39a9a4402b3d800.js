(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{7528:(e,t,s)=>{Promise.resolve().then(s.bind(s,8723))},8723:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>j});var a=s(5155),n=s(2115),l=s(5671);function r(e){var t,s;let{data:r,onSelectionChange:i,colorAttribute:o="cluster"}=e,d=(0,n.useRef)(),[c,u]=(0,n.useState)({width:800,height:600}),[m,h]=(0,n.useState)(null),[x,g]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=()=>{var e;let t=null==(e=d.current)?void 0:e.parentElement;t&&u({width:t.clientWidth,height:Math.max(600,t.clientHeight)})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,n.useEffect)(()=>{if(!r||!d.current)return;let e=l.Ltv(d.current);e.selectAll("*").remove();let t={top:20,right:20,bottom:40,left:40},s=c.width-t.left-t.right,a=c.height-t.top-t.bottom,n=l.m4Y().domain(l.Xxv(r,e=>e.x)).range([0,s]).nice(),u=l.m4Y().domain(l.Xxv(r,e=>e.y)).range([a,0]).nice(),m=e=>o?e[o]||"unknown":"default",g=l.UMr().domain([...new Set(r.map(m))]).range(o?l.t55:["#64748b"]),b=e.attr("width",c.width).attr("height",c.height).append("g").attr("transform","translate(".concat(t.left,",").concat(t.top,")")),f=l.s_O().scaleExtent([.5,10]).on("zoom",e=>{b.attr("transform","translate(".concat(t.left+e.transform.x,",").concat(t.top+e.transform.y,") scale(").concat(e.transform.k,")"))});e.call(f);let j=b.selectAll(".point").data(r).enter().append("circle").attr("class","point").attr("cx",e=>n(e.x)).attr("cy",e=>u(e.y)).attr("r",4).style("fill",e=>g(m(e))).style("opacity",.7).style("stroke","#fff").style("stroke-width",.5).style("cursor","pointer");j.on("mouseover",(e,t)=>{let s=d.current.getBoundingClientRect();h({...t,x:e.clientX-s.left,y:e.clientY-s.top}),l.Ltv(e.target).transition().duration(200).attr("r",6).style("opacity",1)}).on("mousemove",(e,t)=>{let s=d.current.getBoundingClientRect();h(t=>t?{...t,x:e.clientX-s.left,y:e.clientY-s.top}:null)}).on("mouseout",e=>{h(null),l.Ltv(e.target).transition().duration(200).attr("r",4).style("opacity",.7)});let v=[],y=!1,w=e.append("path").attr("class","lasso").style("fill","rgba(59, 130, 246, 0.1)").style("stroke","#3b82f6").style("stroke-width",2).style("stroke-dasharray","5,5").style("opacity",0).style("pointer-events","none"),N=e.append("rect").attr("width",c.width).attr("height",c.height).style("fill","none").style("pointer-events",x?"all":"none").style("cursor",x?"crosshair":"default");N.style("pointer-events",x?"all":"none"),N.on("mousedown",s=>{if(!x)return;s.preventDefault(),s.stopPropagation(),y=!0,v=[];let[a,n]=l.WnM(s,e.node());v.push([a-t.left,n-t.top]),w.style("opacity",1)}),N.on("mousemove",s=>{if(!y||!x)return;s.preventDefault();let[a,n]=l.WnM(s,e.node());if(v.push([a-t.left,n-t.top]),v.length>1){let e="M".concat(v.map(e=>e.join(",")).join("L"),"Z");w.attr("d",e)}}),N.on("mouseup",e=>{if(y&&x){if(e.preventDefault(),y=!1,w.style("opacity",0),v.length>2){let e=r.filter(e=>p([n(e.x),u(e.y)],v));i(e),j.style("stroke",t=>e.some(e=>e.id===t.id)?"#fbbf24":"#fff").style("stroke-width",t=>e.some(e=>e.id===t.id)?3:.5).style("opacity",t=>e.some(e=>e.id===t.id)?1:.7)}v=[]}}),x?e.on(".zoom",null):e.call(f)},[r,c,x,o]);let p=(e,t)=>{let[s,a]=e,n=!1;for(let e=0,l=t.length-1;e<t.length;l=e++){let[r,i]=t[e],[o,d]=t[l];i>a!=d>a&&s<(o-r)*(a-i)/(d-i)+r&&(n=!n)}return n};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"absolute top-4 right-4 z-10 flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>g(!x),className:"px-3 py-1 rounded text-sm font-medium transition-colors ".concat(x?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:x?"Exit Lasso":"Lasso Select"}),i&&(0,a.jsx)("button",{onClick:()=>{i([]),d.current&&l.Ltv(d.current).selectAll(".point").style("stroke","#fff").style("stroke-width",.5).style("opacity",.7)},className:"px-3 py-1 rounded text-sm font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 transition-colors",children:"Clear Selection"})]}),(0,a.jsx)("svg",{ref:d,className:"w-full"}),m&&(0,a.jsxs)("div",{className:"absolute pointer-events-none bg-slate-900 text-white p-3 rounded-lg shadow-xl border border-slate-600 max-w-sm z-20",style:{left:Math.min(m.x+15,c.width-300),top:Math.max(m.y-15,10)},children:[(0,a.jsxs)("div",{className:"font-medium text-sm mb-2 leading-tight",children:[null==(t=m.text)?void 0:t.substring(0,150),(null==(s=m.text)?void 0:s.length)>150?"...":""]}),(0,a.jsxs)("div",{className:"text-xs text-slate-400 flex justify-between",children:[(0,a.jsxs)("span",{children:["Cluster: ",m.cluster]}),(0,a.jsxs)("span",{children:["ID: ",m.id]})]}),m.language&&(0,a.jsxs)("div",{className:"text-xs text-blue-400 mt-1",children:["Topic:"," ",m.language+" "+m.sentiment+" "+m.cats]})]})]})}let i=function(e){let{config:t,onConfigChange:s,isProcessing:n,availableAttributes:l=[],selectedColorAttribute:r=null}=e,i=(e,t)=>{s({[e]:Number(t)})},o=e=>{s({colorAttribute:e})};return(0,a.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700",children:[(0,a.jsx)("h3",{className:"text-white font-semibold mb-4",children:"Parameters"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"border-b border-slate-600 pb-4 mb-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Color by Attribute"}),(0,a.jsxs)("select",{value:r||"",onChange:e=>o(e.target.value||null),disabled:n,className:"w-full p-2 bg-slate-700 border border-slate-600 rounded-md text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"Default (no coloring)"}),l.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),r&&(0,a.jsxs)("p",{className:"text-xs text-slate-400 mt-1",children:["Coloring points by: ",r]})]})}),(0,a.jsxs)("div",{className:"border-b border-slate-600 pb-4 mb-4",children:[(0,a.jsx)("h4",{className:"text-slate-200 font-medium mb-3 text-sm",children:"Embedding Adjustments"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Language: ",t.languageAdjustment]}),(0,a.jsx)("input",{type:"range",min:"-2",max:"2",step:"0.1",value:t.languageAdjustment,onChange:e=>i("languageAdjustment",e.target.value),disabled:n,className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider"}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-slate-400 mt-1",children:[(0,a.jsx)("span",{children:"Increase emphasis"}),(0,a.jsx)("span",{children:"Reduce emphasis"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Sentiment: ",t.sentimentAdjustment]}),(0,a.jsx)("input",{type:"range",min:"-2",max:"2",step:"0.1",value:t.sentimentAdjustment,onChange:e=>i("sentimentAdjustment",e.target.value),disabled:n,className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider"}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-slate-400 mt-1",children:[(0,a.jsx)("span",{children:"Increase emphasis"}),(0,a.jsx)("span",{children:"Reduce emphasis"})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-slate-200 font-medium mb-3 text-sm",children:"UMAP Parameters"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["UMAP Neighbors: ",t.umapNeighbors]}),(0,a.jsx)("input",{type:"range",min:"5",max:"50",value:t.umapNeighbors,onChange:e=>i("umapNeighbors",e.target.value),disabled:n,className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["UMAP Min Distance: ",t.umapMinDist]}),(0,a.jsx)("input",{type:"range",min:"0.01",max:"1",step:"0.01",value:t.umapMinDist,onChange:e=>i("umapMinDist",e.target.value),disabled:n,className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider"})]})]})]})]})]})};function o(e){var t;let{selectedDataset:s,onDatasetChange:n,isLoading:l}=e,r=[{id:"data1",name:"Eng-Fr texts train",description:"Some synthetic data"},{id:"data2",name:"Eng-Fr texts test",description:"Some synthetic data2."}];return(0,a.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700",children:[(0,a.jsx)("h3",{className:"text-white font-semibold mb-4",children:"Dataset Selection"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Choose Dataset"}),(0,a.jsx)("select",{value:s,onChange:e=>n(e.target.value),disabled:l,className:"w-full bg-slate-700 border border-slate-600 text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50",children:r.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))}),s&&(0,a.jsx)("div",{className:"text-sm text-slate-400 mt-2",children:null==(t=r.find(e=>e.id===s))?void 0:t.description}),l&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-blue-400 mt-2",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-400"}),"Loading dataset..."]})]})]})}var d=s(2422);async function c(e,t){let s=e.map(e=>e.embedding);e.map(e=>e.text);let a=await m(s,t),n=await u(a,t),l=function(e){if(!e||0===e.length)return[];let t=Object.keys(e[0]),s=["embedding","text","id"];return t.filter(e=>!s.includes(e))}(e);return{processedData:e.map((e,t)=>({...e,x:n[t][0],y:n[t][1],id:t})),availableAttributes:l}}async function u(e,t){let s=new d.Q({nNeighbors:t.umapNeighbors,minDist:t.umapMinDist,nComponents:2});return await s.fitAsync(e)}async function m(e,t){if(0===t.languageAdjustment&&0===t.sentimentAdjustment)return e;let s=e.map(e=>[...e]);if(0!==t.languageAdjustment){let e=await x("data/language_vector.json");e?s=h(s,e,t.languageAdjustment):console.warn("Language vector not found, skipping language adjustment")}if(0!==t.sentimentAdjustment){let e=await x("data/sentiment_vector.json");e?s=h(s,e,t.sentimentAdjustment):console.warn("Sentiment vector not found, skipping sentiment adjustment")}return s}function h(e,t,s){let a=Math.sqrt(t.reduce((e,t)=>e+t*t,0));if(0===a)return console.warn("Steering vector has zero norm, returning original data"),e;let n=t.map(e=>e/a),l=e.map(e=>e.reduce((e,t,s)=>e+t*n[s],0));return e.map((e,t)=>{let a=l[t];return e.map((e,t)=>e-s*a*n[t])})}async function x(e){try{let t=await fetch(e);if(!t.ok)throw Error("Failed to load ".concat(e,": ").concat(t.statusText));return await t.json()}catch(t){return console.error("Error loading vector ".concat(e,":"),t),null}}let g={data1:()=>b("/data/data1.json"),data2:()=>b("/data/data2.json")};async function p(e){if(!g[e])throw Error("Dataset ".concat(e," not found"));try{return await g[e]()}catch(t){return console.warn("Failed to load ".concat(e,", falling back to sample data:"),t),generateSampleData()}}async function b(e){try{var t,s;let a=await fetch(e);if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let n=await a.json();if(!Array.isArray(n)||!(null==(t=n[0])?void 0:t.embedding)||!(null==(s=n[0])?void 0:s.text))throw Error("Invalid data format. Expected array with embedding and text fields.");return n}catch(t){throw console.error("Error loading dataset from ".concat(e,":"),t),t}}function f(){let[e,t]=(0,n.useState)(null),[s,l]=(0,n.useState)(null),[d,u]=(0,n.useState)([]),[m,h]=(0,n.useState)([]),[x,g]=(0,n.useState)(!1),[b,f]=(0,n.useState)("data1"),[j,v]=(0,n.useState)({umapNeighbors:15,umapMinDist:.1,colorAttribute:null,languageAdjustment:0,sentimentAdjustment:0});(0,n.useEffect)(()=>{w("data1")},[]),(0,n.useEffect)(()=>{e&&y()},[e,j.umapNeighbors,j.umapMinDist,j.languageAdjustment,j.sentimentAdjustment]);let y=async()=>{if(e){g(!0);try{let t=await c(e,j);t.processedData&&t.availableAttributes?(l(t.processedData),u(t.availableAttributes)):(l(t),u([]))}catch(e){console.error("Error processing data:",e)}finally{g(!1)}}},w=async e=>{g(!0);try{let s=await p(e);t(s),h([]),f(e)}catch(e){console.error("Error loading dataset:",e)}finally{g(!1)}};return(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-800 mb-1",children:"Embedding Visual Modifier"}),(0,a.jsx)("p",{className:"text-slate-600 text-sm mb-4",children:"Modify the embeddings based on concepts"})]}),(0,a.jsx)(o,{selectedDataset:b,onDatasetChange:w,isLoading:x}),(0,a.jsx)(i,{config:j,onConfigChange:e=>{v(t=>({...t,...e}))},isProcessing:x,availableAttributes:d,selectedColorAttribute:j.colorAttribute}),m.length>0&&(0,a.jsxs)("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:[(0,a.jsxs)("h3",{className:"text-slate-800 font-semibold mb-3",children:["Selected Points (",m.length,")"]}),(0,a.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2 custom-scrollbar",children:m.map((e,t)=>{var s;return(0,a.jsxs)("div",{className:"text-sm text-slate-700 p-2 bg-white rounded border border-slate-200",children:[(0,a.jsxs)("div",{className:"font-medium",children:[null==(s=e.text)?void 0:s.substring(0,50),"..."]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:[j.colorAttribute&&e[j.colorAttribute]&&(0,a.jsxs)(a.Fragment,{children:[j.colorAttribute,": ",e[j.colorAttribute]," ","|"," "]}),"ID: ",e.id]})]},t)})})]})]}),(0,a.jsx)("div",{className:"lg:col-span-3",children:(0,a.jsx)("div",{className:"bg-white rounded-lg border-2 border-black overflow-hidden",children:x?(0,a.jsx)("div",{className:"h-96 flex items-center justify-center bg-white",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-slate-700",children:"Processing embeddings..."})]})}):s?(0,a.jsx)(r,{data:s,colorAttribute:j.colorAttribute,onSelectionChange:h}):(0,a.jsx)("div",{className:"h-96 flex items-center justify-center text-slate-500 bg-white",children:"Select a dataset to begin visualization"})})})]})}function j(){return(0,a.jsx)("main",{className:"min-h-screen bg-white",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)(f,{})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[148,441,684,358],()=>t(7528)),_N_E=e.O()}]);